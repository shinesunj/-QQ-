var dataList,len,control,root=window.player,audio=root.AudioManager,timer=null,duration=0,flag=!0;function getData(o){$.ajax({type:"GET",url:o,success:function(o){len=o.length,control=new root.ControlIndex(len),dataList=o,root.randerList.renderlist(dataList),root.render(o[0]),audio.getAudio(o[0].audio),root.pro.renderAllTime(o[0].duration),duration=o[0].duration,bindEvent(),bindTouchEvent()},error:function(){}})}function bindEvent(){$("body").on("play:change",function(o,t){audio.getAudio(dataList[t].audio),root.render(dataList[t]),root.pro.renderAllTime(dataList[t].duration),duration=dataList[t].duration,"play"==audio.status?(rotated(0),root.pro.start(0),audio.play()):root.pro.update(0),$(".img-box").attr("data-deg",0),$(".img-box").css({transform:"rotateZ(0deg)",transition:"none"})}),$(".prev").on("click",function(){var o=control.prev();$("body").trigger("play:change",o),root.pro.stop(),"play"==audio.status?(root.pro.start(),root.pro.stop()):(root.pro.stop(),root.pro.update(0))}),$(".next").on("click",function(){var o=control.next();$("body").trigger("play:change",o),root.pro.stop(),"play"==audio.status?(root.pro.start(),root.pro.stop()):(root.pro.stop(),root.pro.update(0))}),$(".play").on("click",function(){"pause"==audio.status?(audio.play(),root.pro.start(),rotated($(".img-box").attr("data-deg"))):(audio.pause(),root.pro.stop(),clearInterval(timer));$(".play").toggleClass("playing")}),$(".list").on("click",function(){flag&&($(".playList").css({bottom:0}),flag=!1)}),$(".close").on("click",function(){flag||($(".playList").css({bottom:-410}),flag=!0)}),$(".list-wrapper").on("click","li",function(){var o=$(this).index();root.pro.stop(),$("body").trigger("play:change",o),root.pro.stop(),audio.play(),root.pro.start(),$(".play").addClass("playing")})}function bindTouchEvent(){$(".slider").on("touchstart",function(o){root.pro.stop()}).on("touchmove",function(o){var t=$(".pro-bottom").offset().left,a=$(".pro-bottom").offset().width,r=(o.changedTouches[0].clientX-t)/a;0<=r&&r<1&&root.pro.update(r)}).on("touchend",function(o){var t=$(".pro-bottom").offset().left,a=$(".pro-bottom").offset().width,r=(o.changedTouches[0].clientX-t)/a,n=r*duration;0<=r&&r<1&&(audio.playto(n),audio.play(),root.pro.start(r),$(".play").addClass("playing"))})}function rotated(o){clearInterval(timer),o=+o,timer=setInterval(function(){o+=2,$(".img-box").attr("data-deg",o),$(".img-box").css({transform:"rotateZ("+o+"deg)",transition:"all 1s ease-out"})},200)}$(audio.audio).on("ended",function(){$(".next").trigger("click")}),getData("../mock/data.json");